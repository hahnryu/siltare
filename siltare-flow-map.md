# 실타래 플로우 맵 + 수익 구조

> 작성일: 2026-02-25
> 목적: 코드 작성 전 유저 플로우, 상태 전이, 수익 모델, 로그인 정책 확정
> 이 문서가 확정되어야 코드 설계가 나옴


## 1. 등장인물

| 역할 | 예시 | 설명 |
|------|------|------|
| 요청자 (Requester) | 아들 민수 | 링크를 보내는 사람. 30~50대. |
| 인터뷰이 (Interviewee) | 아버지 영호 | 이야기를 하는 사람. 60~80대. |
| AI | 실타래 | 구술사 연구자 페르소나. 아버지와 주 대화. |


## 2. 인터뷰 상태 전이

```
pending ──→ active ──→ paused ──→ active ──→ complete
(생성됨)    (대화중)    (중단)     (이어하기)   (종료)

                                    ↓
                              archived
                           (분석 완료, 결제 가능)
```

| 상태 | 의미 | 전이 조건 |
|------|------|-----------|
| pending | 링크 생성됨, 아무도 안 들어옴 | /request에서 생성 |
| active | 대화 진행 중 | 인터뷰이가 /i/{id} 동의 후 진입 |
| paused | 대화 중단 (브라우저 닫음, "나중에 이어하기") | 인터뷰이 이탈 감지 또는 명시적 중단 |
| active | 이어하기 | 인터뷰이 재진입 |
| complete | "오늘은 여기까지" 클릭 | /api/complete 호출 |
| archived | 요약/분석/챕터 생성 완료 | complete 후 AI 후처리 완료 |


## 3. 유저 플로우

### 3-A. 아들 (요청자) 플로우

```
[홈 /]
  │
  ├──→ [/request] 실타래 만들기
  │      │
  │      ├── [메인 UX: 음성 입력]
  │      │     마이크 버튼 하나.
  │      │     "누구한테 보내실 건가요? 편하게 말씀해주세요."
  │      │     ─→ Whisper 텍스트 변환
  │      │     ─→ GPT-4o 파싱 (관계, 이름, 연령, 궁금한 것, 연락처)
  │      │     ─→ 파싱 결과 카드로 표시
  │      │     ─→ "이대로 보낼까요?" 확인
  │      │
  │      ├── [인사 녹음]
  │      │     파싱 확인 후, 링크 생성 전:
  │      │     "아버지한테 한마디 남겨주세요."
  │      │     마이크 버튼 → 녹음 → 오디오 버블 → 확인
  │      │     (선택 사항. "건너뛰기" 가능)
  │      │     녹음된 인사말은 interview 레코드에 greetingAudioUrl로 저장
  │      │
  │      ├── [링크 생성]
  │      │
  │      ├── [폴백: 텍스트 폼]
  │      │     "직접 입력하기" 링크
  │      │     기존 4단계 폼 (관계 → 정보 → 질문 → 연락처)
  │      │
  │      └──→ [결과 화면]
  │              ├── 링크 복사
  │              ├── 카카오톡 전송
  │              └── 테스트 (개발자용)
  │
  ├──→ [/interview/{id}] 대화 참여 (단톡방)
  │      ─→ 노크 (대기실)
  │      ─→ 아버지가 허락 → 입장
  │      ─→ 채팅에 메시지 남김 (오탈자 정정, 질문)
  │      ─→ 아버지가 내보내기 → 대기실로
  │
  └──→ [/archive/{id}] 인터뷰의 집 (개별 1건)
         ─→ AI 요약, 목차, 전체 대화, 음성 재생
         ─→ 이어서 대화하기
         ─→ 분석 리포트 구매
         ─→ 책 주문
         ─→ 가족 공유
```

### /my 페이지는 없음
/archive/{id}가 인터뷰의 집. 당사자 누구나 링크로 접근.
인터뷰 목록이 필요해지는 시점(한 사람이 3건 이상)에
헤더 드롭다운 또는 별도 페이지로 추가. 지금은 불필요.

### 3-B. 아버지 (인터뷰이) 플로우

```
[카카오톡 링크 수신]
  |
  +---> [/i/{id}] 동의 화면
  |      +-- status: pending --> 동의 --> /interview/{id}
  |      +-- status: paused --> "지난 이야기 이어하기" --> /interview/{id}
  |      +-- status: complete --> /archive/{id} 리다이렉트
  |
  +---> [/interview/{id}] AI 대화
  |      |
  |      +-- [첫 방문]
  |      |     1. 인사 녹음 재생 (있으면):
  |      |        "민수님이 보낸 메시지입니다" + 오디오 플레이어
  |      |     2. AI 첫 메시지:
  |      |        "민수님이 이야기를 여쭙고 싶어서 이 자리를 마련했습니다..."
  |      |     3. 대화 시작
  |      |
  |      +-- [재방문 (paused)]
  |      |     1. 이전 대화 전체 표시 (스크롤 가능)
  |      |     2. 하단에 "이어서 이야기하기" 버튼
  |      |     3. 버튼 클릭 --> AI가 맥락 이어받기:
  |      |        "지난번에 영도다리 근처 이야기를 해주셨는데,
  |      |         그 뒤로는 어떻게 되셨어요?"
  |      |
  |      +-- 음성 녹음 --> 오디오 버블 --> 변환 --> 전송
  |      +-- 텍스트 입력 --> 조각 추가 --> 전송
  |      +-- 아들 노크 알림 --> 허락/거절
  |      +-- 아들 내보내기
  |      |
  |      +-- "오늘은 여기까지" 클릭
  |            |
  |            v
  |            [완료 화면]
  |            "소중한 이야기가 기록되었습니다."
  |            +-- [카카오로 연결하기] (기록 보관 + 알림)
  |            +-- [나중에]
  |            +-- "다음에 이어하시려면:"
  |            |    +-- [이 링크를 카카오톡에 저장] (나에게 보내기)
  |            |    +-- (카카오 연결 시) 내일 카톡 알림:
  |            |        "어제 이야기 이어하실까요?"
  |            +-- [기록 보러가기] --> /archive/{id}
  |
  +---> [/archive/{id}] 결과 확인
         --> AI 요약 읽기
         --> 음성 원본 듣기
         --> 이어서 대화하기 (여기서도 가능)
         --> 카카오 연결 (기록 보관용)
```

### 3-C. AI 플로우 (내부 로직)

```
[첫 메시지]
  ├── 인터뷰이만 있을 때: Phase 1~4 대로 대화
  ├── 요청자 메시지 감지 시:
  │     ├── 오탈자 정정 → 반영 후 대화 계속
  │     ├── 질문 → "참, 민수님이 이것도 궁금해하시는데요..." 자연스럽게 삽입
  │     └── 일반 코멘트 → 가볍게 인정 후 인터뷰이에게 집중
  └── 요청자 입장/퇴장 시: 별도 언급 없이 대화 계속
```


## 4. 로그인 정책

### 원칙
- 가입은 필수. 단, 첫 경험 후에 시킴 (마찰 0 진입 유지)
- 가입해야 갠톡 업데이트, 이어하기, 결제 가능
- 양쪽 다 가입시켜야 진척 상황 알림이 돌아감

### 가입 유도 타이밍

#### 아버지 (인터뷰이)
```
대화 시작: 로그인 없음 (링크만으로 진입)
     |
     v  30분 대화
     |
대화 완료 ("오늘은 여기까지"):
     "소중한 이야기가 기록되었습니다."
     "다음에 이어하시려면 카카오로 연결해주세요."
     [카카오로 연결하기]  ← 이걸 강하게 유도. 버튼 크고 눈에 띄게.
     "건너뛰기" ← 작고 연하게. 건너뛰면 이어하기/알림 불가 안내.
```

#### 아들 (요청자)
```
링크 생성 직후:
     "아버지의 이야기가 시작되면 카톡으로 알려드릴까요?"
     [카카오로 연결하기]  ← 강하게 유도
     "이메일로만 받기" ← 작고 연하게
```

### 가입 안 하면?
동작은 하지만 제한적:

| 기능 | 비가입 | 가입 |
|------|--------|------|
| 첫 대화 1회 | O | O |
| 아카이브 열람 (링크) | O | O |
| 갠톡 진척 알림 | X | O |
| 대화 이어하기 | X | O |
| 결제 (분석/책) | X | O |
| 대화 참여 (단톡방) | X | O |
| 가족 공유 | 링크만 | 카톡 공유 |

건너뛰기를 누른 경우, /archive/{id}에서 다시 카카오 연결 유도:
"카카오로 연결하시면 다음 이야기를 이어하실 수 있어요."


## 4-B. 카카오 알림 시나리오

### 아버지에게 보내는 알림

| 시점 | 메시지 | 조건 |
|------|--------|------|
| 대화 다음날 오전 10시 | "어제 이야기 이어하실까요? 지난번에 [마지막 주제] 이야기를 해주셨어요. [이어하기]" | status: session_end |
| 3일 후 | "틈나실 때 이야기 이어해주세요. 민수님이 기다리고 있어요. [이어하기]" | status: session_end, 미재방문 |
| 7일 후 (마지막) | "언제든 편하실 때 오세요. [이어하기]" | status: session_end, 미재방문 |
| 아들 참여 시 | "민수님이 대화에 참여하고 싶어합니다. [허락하기]" | requester knock |
| 분석 완료 시 | "이야기 분석이 완료되었습니다. [결과 보기]" | 분석 리포트 생성 완료 |

### 아들에게 보내는 알림

| 시점 | 메시지 | 조건 |
|------|--------|------|
| 아버지 대화 시작 | "아버지가 이야기를 시작하셨습니다." | status: pending --> active |
| 아버지 1회차 완료 | "아버지가 오늘 이야기를 마치셨습니다. 30분, 4,280자가 기록되었어요. [아카이브 보기]" | status: session_end |
| 아버지 이어하기 | "아버지가 이야기를 이어하고 계십니다." | status: session_end --> active |
| 아버지 추가 완료 | "아버지가 15분 더 이야기하셨습니다. 새 내용이 추가되었어요. [아카이브 보기]" | 2회차 이상 session_end |
| 최종 완료 | "아버지의 이야기가 완성되었습니다. 총 {시간}, {글자수}자. [아카이브 보기]" | status: complete |
| 분석 완료 | "아버지 성격 분석 리포트가 준비되었습니다. [리포트 보기]" | 분석 생성 완료 |
| 아버지 미활동 7일 | "아버지가 아직 이야기를 시작하지 않으셨어요. 한번 더 보내드릴까요? [다시 보내기]" | status: pending, 7일 경과 |

### 알림 원칙
- 아버지에게: 최대 3회까지만 (스팸 방지). 부드러운 톤.
- 아들에게: 진척 있을 때마다. 구체적 숫자 포함 (몇 분, 몇 자).
- 양쪽 다 알림 끄기 가능.
- 밤 9시 이후, 아침 9시 이전 알림 안 보냄.


## 5. 수익 모델

### 5-A. 가격 구조

| 티어 | 가격 | 포함 내용 |
|------|------|-----------|
| 무료 | ₩0 | AI 대화 1회 (30분), 텍스트 아카이브, 공유 링크 |
| 기록 보관 | ₩9,900 | 음성 원본 영구 보관, AI 편집 요약, 챕터 자동 생성 |
| 성격 분석 | ₩19,000 | 1인 성격 프로파일, 가치관 맵, 인생 타임라인 |
| 관계 분석 | ₩29,000 | 2인 이상 관계 다이나믹, 반복 패턴, 세대 비교 |
| 자서전 책 | ₩79,000~ | 소프트커버 1권, 표지 커스터마이징, 배송 |
| 이어하기 | ₩9,900/회 | 2회차부터 유료 (추가 30분 대화) |
| 가족 구독 | 월 ₩9,900 | 무제한 대화, 분석, 음성 보관, 가족 볼트 |

### 5-B. AI 분석 상품 상세

#### 1인 분석 (아버지 한 명의 대화에서)
- 성격 프로파일: 자주 쓰는 단어, 감정 표현 패턴, 회피하는 주제
- 가치관 맵: 가장 많이 언급한 것 (가족/일/고향/신앙 등)
- 인생 타임라인 자동 생성
- "가장 오래 머문 이야기" (시간 비중 분석)
- 말투 분석: 자주 쓰는 표현, 세대 특유 어휘

#### 2인 분석 (아버지 + 아들 둘 다 인터뷰 시)
- 같은 사건을 어떻게 다르게 기억하는지
- 부모가 자주 하는 말이 자녀에게 어떻게 전이되었는지
- 감정 온도 차이: 아버지가 담담하게 말한 것을 아들이 가장 아파하는 것
- 관계 키워드: 서로를 어떤 단어로 묘사하는지

#### 가족 단위 (3명 이상)
- 가족 서사 지도: 누가 어떤 기억의 중심인지
- 세대 간 가치관 변화 시각화
- "우리 가족이 가장 많이 한 말"
- 가족 관계 다이나믹 리포트

### 5-C. 전환 퍼널

```
무료 대화 완료 (100%)
  │
  ├── 아카이브 확인 (70%)
  │     │
  │     ├── "음성 원본 보관" 구매 (15%) ── ₩9,900
  │     │
  │     ├── "성격 분석 리포트" 구매 (8%) ── ₩19,000
  │     │
  │     └── "엄마도 해보세요" 바이럴 (20%)
  │           │
  │           └── 2인 관계 분석 구매 (5%) ── ₩29,000
  │
  ├── 이어하기 구매 (10%) ── ₩9,900
  │
  └── 자서전 책 주문 (3%) ── ₩79,000
```

### 5-D. 수익 시점 (아카이브 페이지)

아카이브 하단 CTA 순서:
1. "음성 원본 보관하기" ₩9,900 (가장 낮은 허들)
2. "성격/가치관 분석 리포트" ₩19,000
3. "자서전 책으로 만들기" ₩79,000
4. "이어서 대화하기" ₩9,900 (다회차)
5. "가족에게 공유하기" (무료, 바이럴)


## 6. 단톡방 구조

### 메시지 구분

| 발신자 | role | 표시 | 색상 |
|--------|------|------|------|
| AI (실타래) | assistant | "실타래" 라벨, 좌측 | warm-white, mist 보더 |
| 인터뷰이 (아버지) | user | 이름 없음, 우측 | amber/10 |
| 요청자 (아들) | requester | "{이름}" 라벨, 우측 | 별도 색상 (leaf/10 등), 구분 가능하게 |

### Message 인터페이스 확장
```typescript
interface Message {
  id: string;
  role: 'assistant' | 'user' | 'requester';
  sender?: string;      // 표시 이름 ("민수", "실타래")
  content: string;
  timestamp: string;
  audioUrl?: string;
}
```

### 노크/입장 시스템

인터뷰 레코드에 participants 필드 추가:
```typescript
participants?: {
  interviewee: { joined: boolean };
  requester: {
    status: 'none' | 'waiting' | 'joined' | 'kicked';
    knockedAt?: string;
  };
}
```

| 상태 | 아버지 화면 | 아들 화면 |
|------|------------|----------|
| none | 변화 없음 | /interview/{id} 접근 시 "노크하기" 버튼 |
| waiting | "민수님이 참여하고 싶어합니다" 알림 + 허락/거절 | 대기실: "허락을 기다리고 있습니다..." |
| joined | 아들 메시지가 채팅에 보임 + "내보내기" 버튼 | 채팅 참여 가능 |
| kicked | 변화 없음 | 대기실: "대화가 끝나면 알려드리겠습니다" |

아들 쪽은 participants.requester.status를 3초마다 polling.


## 7. 구현 우선순위

### Phase 0: 시연 가능 (이번 주, 김서준 캐치업)
- [x] 텔레그램 스타일 음성 UX (Task 1)
- [x] 오디오 원본 보존 (Task 2)
- [x] 아카이브 v0 디자인 복원
- [ ] "오늘은 여기까지" 플로우 확인
- [ ] 모바일 end-to-end 테스트

### Phase 1: 어버이날 MVP (5월 8일)
- [ ] /request 음성 입력 UX (폼 → 음성 파싱 + 확인)
- [ ] 대화 이어하기 (F-028): /i/{id} 재방문 분기
- [ ] 결제 연동 (Toss): 기록 보관 ₩9,900
- [ ] 카카오 로그인 - 아들 (F-031)
- [ ] 카카오 연결 - 아버지 (F-032)
- [ ] 이메일 결과 전송
- [ ] 성격 분석 리포트 v1

### Phase 2: 관계 분석 (6~7월)
- [ ] 셀프 모드 완성 (F-025)
- [ ] 2인 관계 분석 리포트
- [ ] 단톡방 구조 (F-029)
- [ ] 노크/입장 (F-030)
- [ ] 아카이브 공동 편집 (F-024)
- [ ] 인터뷰 목록 (필요 시 헤더 드롭다운 또는 /my 페이지)

### Phase 3: 구독 + 스케일 (8~9월)
- [ ] 가족 구독 월 ₩9,900
- [ ] 가족 서사 지도 (3인 이상 분석)
- [ ] 자서전 책 주문 연동
- [ ] 다국어 (영어, 일본어)
- [ ] B2B (요양원, 종중, 종교 단체)


## 8. /request 음성 입력 설계

### UX 플로우

```
[/request 페이지]
  │
  ├── 화면 중앙: 마이크 버튼 (72px)
  │   "누구한테 보내실 건가요? 편하게 말씀해주세요."
  │
  ├── 녹음 → Whisper → 텍스트
  │
  ├── 텍스트 → GPT-4o 파싱 API
  │   시스템 프롬프트:
  │   "사용자의 음성 메시지에서 다음 정보를 추출하세요.
  │    빠진 정보는 null로. 반드시 JSON만 반환.
  │    { relationship, intervieweeName, ageGroup,
  │      context[], requesterName, requesterEmail }"
  │
  ├── 파싱 결과를 카드로 표시:
  │   ┌────────────────────────┐
  │   │ 관계: 어머니            │
  │   │ 성함: 김영순            │
  │   │ 연령대: 70대            │
  │   │ 궁금한 것:              │
  │   │  · 어린 시절 안동 이야기  │
  │   │  · 아버지 만난 이야기     │
  │   │ 보내는 사람: 민수        │
  │   │ 이메일: minsu@gmail.com │
  │   │                        │
  │   │ [빠진 정보 있으면 입력란] │
  │   │                        │
  │   │ [수정하기]  [이대로 보내기]│
  │   └────────────────────────┘
  │
  ├── 빠진 정보 처리:
  │   파싱에서 null인 필드 → 해당 필드만 입력란 노출
  │   또는 "더 말씀해주세요" → 추가 녹음
  │
  └── "이대로 보내기" → /api/create-interview → 결과 화면
```

### 하단에 폴백
"직접 입력하기" 텍스트 링크 → 기존 4단계 폼으로 전환.
기존 폼 코드는 삭제하지 않음. 음성이 안 되는 환경 대비.


## 9. 인사 녹음 설계

### 목적
차가운 AI 인터뷰가 아니라, 가족의 부탁으로 시작하는 대화.
아버지가 채팅방에 들어왔을 때 아들의 육성을 먼저 듣게 함.

### /request에서의 녹음 플로우
```
[파싱 결과 확인 완료]
  |
  v
"아버지한테 한마디 남겨주세요."
"목소리로 인사말을 보내면, 아버지가 대화를 시작하기 전에 들으실 수 있어요."
  |
  +-- 마이크 버튼 --> 녹음 --> 오디오 버블 (재생/다시녹음/삭제)
  +-- "건너뛰기" (선택 사항)
  |
  v
[링크 생성] (greetingAudioUrl을 interview 레코드에 저장)
```

### /interview/{id}에서의 재생 플로우
```
[첫 진입]
  |
  v
[인사 메시지 카드]
  "민수님이 보낸 메시지입니다"
  [오디오 플레이어 - 재생 버튼 + 파형]
  (자동 재생하지 않음. 어르신이 직접 재생 버튼을 누르도록)
  |
  v  (재생 완료 또는 스킵)
  |
[AI 첫 메시지]
  "민수님이 아버지의 이야기를 여쭙고 싶어서..."
```

### 데이터
Interview 레코드에 추가:
```typescript
greetingAudioUrl?: string;   // Supabase Storage 경로
greetingDuration?: number;   // 초
```


## 10. 재방문 경험 설계 (리추얼리스틱 채팅방)

### 핵심 원칙
이 채팅방은 일회성 도구가 아니라,
반복해서 돌아와 조금씩 이야기를 쌓아가는 공간.
"리추얼리스틱 구술 자서전용 채팅방."

### "오늘은 여기까지" 이후 플로우

```
["오늘은 여기까지" 클릭]
  |
  v
[완료 화면] (/interview/{id} 내부, 또는 별도 화면)
  |
  +-- "소중한 이야기가 기록되었습니다."
  |
  +-- [카카오로 연결하기]
  |     "기록을 보관하고 다음에 이어하시려면 연결해주세요."
  |
  +-- [이 링크를 저장해두세요]
  |     +-- [카카오톡 나에게 보내기] (카카오 공유 API)
  |     +-- 링크 복사 버튼
  |     +-- (카카오 연결한 경우) "내일 카톡으로 알려드리겠습니다."
  |
  +-- [기록 보러가기] --> /archive/{id}
```

status: active --> paused (또는 "session_complete"로 1회차 완료 표시)

### 재진입 플로우

```
[같은 링크 /i/{id}로 다시 방문]
  |
  v
[/i/{id}] 동의 화면 변형
  "지난번 이야기를 이어하시겠어요?"
  +-- [이전 대화 요약 미리보기] (AI 요약 2~3문장)
  +-- [이어서 이야기하기] --> /interview/{id}
  +-- [기록만 보기] --> /archive/{id}
  |
  v
[/interview/{id}] 재방문
  1. 이전 대화 전체 표시
     - 날짜 구분선: "--- 2월 25일 ---"
     - 스크롤로 과거 대화 열람 가능
  2. 하단에 "이어서 이야기하기" 버튼
  3. 버튼 클릭시 AI 이어받기 메시지:
     "지난번에 [마지막 주제] 이야기를 해주셨는데,
      그 뒤로는 어떻게 되셨어요?"
     (AI가 messages를 읽고 마지막 주제를 파악해서 생성)
  4. status: paused --> active
```

### 날짜 구분선
다회차 대화에서 시간의 흐름을 보여줌:
```
[2월 25일]
  실타래: 민수님이 이야기를 여쭙고 싶어서...
  아버지: 내가 서울 성북동에서 자랐다고...
  실타래: 성북동의 어린 시절이 기억에 남으실 것 같네요.
  아버지: 잘몰러
  ...
  [오늘은 여기까지]

  ─── 2월 27일 ───

  실타래: 지난번에 성북동 이야기를 해주셨는데, 
          학교 다니실 때 이야기도 들려주실 수 있을까요?
  아버지: 홍익사대부속중학교를 다녔는데...
```

### 카카오톡 리마인더 (카카오 연결한 경우)
```
[다음날 오전 10시]
카카오톡 알림:
  "어제 이야기 이어하실까요?
   지난번에 성북동 이야기를 해주셨어요.
   [이어서 이야기하기] 링크"
```
이 알림은 2~3일 간격으로, 최대 3회까지만.
(스팸 느낌 방지. 어르신이 원할 때 자연스럽게 돌아오도록.)

### Interview 상태 확장
```
pending --> active --> session_end --> active --> session_end --> complete
                      (1회차 완료)              (2회차 완료)    (최종 완료)
```
session_end와 complete의 차이:
- session_end: "오늘은 여기까지". 이어하기 가능.
- complete: "모든 이야기를 마쳤습니다". 최종 완료. 아카이브 확정.

"모든 이야기를 마쳤습니다"는 인터뷰이 또는 요청자가 명시적으로 선택.
또는 AI가 "충분한 이야기를 들었다"고 판단했을 때 제안.


## 11. 코드 구조 원칙

이 플로우 맵에 따라 코드를 작성할 때:

### 페이지 구조 (3개만)
```
/dashboard          관리자 전용. 전체 통계.
/archive/{id}       인터뷰의 집. 당사자 누구나. 링크 기반.
                    (요약, 음성, 대화, 분석, 책, 공유, 이어하기)
/interview/{id}     대화방. 실시간 대화.
```
/my는 당분간 없음. 인터뷰 목록이 필요해지면 헤더 드롭다운으로.

### interview page 초기화 분기
1. status: pending + messages 없음 → AI 첫 메시지
2. status: active/paused + messages 있음 → 기존 대화 로드, AI "돌아오셨군요"
3. status: complete → /archive/{id}로 리다이렉트

### Message.role 확장 타이밍
- Phase 0~1: 'assistant' | 'user'만 사용
- Phase 2: 'requester' 추가 (단톡방)
- 지금 코드가 role === 'user'로 하드코딩된 곳들을 미리 확인

### 결제 UI 위치
- 아카이브 페이지 하단에 집중
- /book/{id}는 유지하되, 아카이브에서 직접 결제 가능하도록

### 로그인 미들웨어
- 현재: /dashboard만 보호
- Phase 1 추가: 결제 API, 이어하기 API 보호
- Phase 2 추가: 대화 참여(노크) API 보호
